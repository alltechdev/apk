name: Setup APK Signing Keystore

on:
  workflow_dispatch:

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Generate Keystore
        run: |
          keytool -genkey -v \
            -keystore apk-builder.keystore \
            -alias apk-builder \
            -keyalg RSA \
            -keysize 2048 \
            -validity 10000 \
            -storepass android123 \
            -keypass android123 \
            -dname "CN=APK Builder, OU=Development, O=APK Builder, L=Unknown, ST=Unknown, C=US"

          # Convert to base64
          base64 apk-builder.keystore > keystore.b64

          echo "Keystore generated and encoded to base64"
          echo "Add the following secrets to your repository:"
          echo ""
          echo "KEYSTORE_FILE:"
          cat keystore.b64
          echo ""
          echo "KEYSTORE_PASSWORD: android123"
          echo "KEY_ALIAS: apk-builder"
          echo "KEY_PASSWORD: android123"

      - name: Upload keystore
        uses: actions/upload-artifact@v4
        with:
          name: keystore
          path: |
            apk-builder.keystore
            keystore.b64
